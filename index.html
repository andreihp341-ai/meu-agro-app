<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroTech AI - Intelig√™ncia Agr√≠cola</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2ecc71">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/188/188333.png">

    <style>
        :root { --primary: #2ecc71; --dark: #1e272e; --light: #f5f6fa; --accent: #3498db; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        
        body { background-color: var(--light); display: flex; flex-direction: column; height: 100vh; color: #2f3640; }

        /* Cabe√ßalho */
        header { background-color: var(--dark); color: white; padding: 15px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        header b { color: var(--primary); }

        /* Sele√ß√£o de Perfil */
        #profile-selector {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(30,39,46,0.98); z-index: 1000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white; padding: 20px; text-align: center;
        }
        .role-btn {
            background: white; color: var(--dark); padding: 15px; margin: 8px;
            border-radius: 12px; width: 100%; max-width: 320px; cursor: pointer; 
            border: none; font-size: 1rem; font-weight: bold; transition: 0.3s;
        }
        .role-btn:active { transform: scale(0.95); background: var(--primary); color: white; }

        /* Interface Principal */
        #main-interface { display: none; flex: 1; flex-direction: column; overflow: hidden; }
        
        #chat { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 12px; }
        
        .message { padding: 12px 16px; border-radius: 15px; max-width: 85%; line-height: 1.5; font-size: 0.95rem; }
        .bot-msg { background: white; align-self: flex-start; border-left: 5px solid var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .user-msg { background: var(--primary); color: white; align-self: flex-end; box-shadow: 0 2px 5px rgba(46,204,113,0.3); }
        
        .img-msg { max-width: 100%; border-radius: 10px; margin-top: 8px; border: 2px solid white; }

        /* √Årea de Digita√ß√£o */
        .input-area { display: flex; gap: 10px; padding: 15px; background: white; border-top: 1px solid #eee; align-items: center; }
        input { flex: 1; padding: 12px 18px; border: 1px solid #ddd; border-radius: 25px; outline: none; font-size: 1rem; }
        input:focus { border-color: var(--primary); }
        
        .btn-action { border: none; border-radius: 50%; width: 45px; height: 45px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .camera-btn { background: var(--accent); color: white; font-size: 1.2rem; }
        .send-btn { background: var(--primary); color: white; font-size: 1.2rem; }
    </style>
</head>
<body>

    <div id="profile-selector">
        <h2 style="margin-bottom: 10px;">AgroTech AI</h2>
        <p style="margin-bottom: 25px; opacity: 0.8;">Selecione seu perfil para um atendimento especializado:</p>
        <button class="role-btn" onclick="selectRole('produtor')">üë®‚Äçüåæ Produtor Rural</button>
        <button class="role-btn" onclick="selectRole('agronomo')">üìã Engenheiro Agr√¥nomo</button>
        <button class="role-btn" onclick="selectRole('estudante')">üéì Estudante / Pesquisador</button>
    </div>

    <header>Agro<b>Tech</b> AI</header>

    <div id="main-interface">
        <div id="chat">
            <div class="message bot-msg">
                Ol√°! Sou sua assistente Agro. Use o √≠cone da üì∑ para analisar uma praga ou escreva sua d√∫vida sobre manejo e defensivos.
            </div>
        </div>

        <div class="input-area">
            <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display: none;" onchange="handleImage(this)">
            
            <button class="btn-action camera-btn" onclick="document.getElementById('cameraInput').click()">üì∑</button>
            
            <input type="text" id="userInput" placeholder="Ex: Ferrugem da soja..." onkeypress="handleEnter(event)">
            
            <button class="btn-action send-btn" onclick="sendMessage()">‚û§</button>
        </div>
    </div>

    <script>
        let currentUserRole = 'produtor';

        // Banco de Dados Especializado
        const responses = {
            'produtor': { 
                default: "Sugest√£o: Foque no custo-benef√≠cio. Se a press√£o de pragas estiver baixa, avalie o uso de biol√≥gicos para economizar no qu√≠mico. Mantenha o solo corrigido para evitar perdas.",
                image: "An√°lise Visual: Suspeita de praga/doen√ßa. Se for Ferrugem, a perda de produtividade pode ser alta. Recomendo consultar o pre√ßo m√©dio de fungicidas sist√™micos na sua cooperativa.",
                keywords: { "herbicida": "Use herbicidas pr√©-emergentes para manter o limpo por mais tempo e economizar combust√≠vel de trator.", "soja": "A soja exige aten√ß√£o no fechamento das entrelinhas. Monitore percevejos agora!" }
            },
            'agronomo': { 
                default: "Recomenda√ß√£o T√©cnica: Analise o est√°dio fenol√≥gico (R1-R5). Considere a rota√ß√£o de princ√≠pios ativos para evitar resist√™ncia. Aten√ß√£o ao pH da calda de aplica√ß√£o.",
                image: "Diagn√≥stico: Sintomatologia compat√≠vel com estresse bi√≥tico. Recomendo aplica√ß√£o de Triazol + Estrobilurina + Multiss√≠tio (ex: Mancozeb) para prote√ß√£o completa.",
                keywords: { "herbicida": "Mecanismo de a√ß√£o: Inibidores da ACCase ou ALS? Verifique o hist√≥rico de resist√™ncia da √°rea.", "soja": "Monitorar n√≠vel de dano econ√¥mico (NDE) para percevejo marrom e lagarta da soja." }
            },
            'estudante': { 
                default: "Dica Acad√™mica: Pesquise sobre a Fisiopatologia desta cultura. Entender o ciclo de vida do pat√≥geno √© fundamental para o manejo integrado (MIP).",
                image: "Observa√ß√£o Fisiol√≥gica: Note as manchas clor√≥ticas evoluindo para necrose. Estude como esse fungo interfere na fotoss√≠ntese da planta.",
                keywords: { "herbicida": "Estude a transloca√ß√£o via xilema e floema dos herbicidas sist√™micos.", "soja": "Pesquise sobre a fixa√ß√£o biol√≥gica de nitrog√™nio (FBN) via Bradyrhizobium." }
            }
        };

        function selectRole(role) {
            currentUserRole = role;
            document.getElementById('profile-selector').style.display = 'none';
            document.getElementById('main-interface').style.display = 'flex';
            addMsg(`Perfil definido como: <b>${role.toUpperCase()}</b>`, 'bot');
        }

        function addMsg(text, type, imgUrl = null) {
            const chat = document.getElementById('chat');
            const div = document.createElement('div');
            div.className = `message ${type}-msg`;
            
            if (imgUrl) {
                div.innerHTML = `Analisando imagem:<br><img src="${imgUrl}" class="img-msg">`;
            } else {
                div.innerHTML = text;
            }
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('userInput');
            const text = input.value.trim().toLowerCase();
            if(!text) return;
            
            addMsg(input.value, 'user');
            input.value = '';

            setTimeout(() => {
                let reply = responses[currentUserRole].default;
                
                // Busca por palavras-chave
                for (let key in responses[currentUserRole].keywords) {
                    if (text.includes(key)) {
                        reply = responses[currentUserRole].keywords[key];
                    }
                }
                
                addMsg(reply, 'bot');
            }, 600);
        }

        function handleImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    addMsg("", 'user', e.target.result);
                    setTimeout(() => addMsg("üîç <b>Processando imagem com IA agr√≠cola...</b>", 'bot'), 600);
                    setTimeout(() => addMsg(responses[currentUserRole].image, 'bot'), 2500);
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function handleEnter(e) { if(e.key === 'Enter') sendMessage(); }

        // Ativa o modo Offline
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./service-worker.js');
        }
    </script>
</body>
</html>

