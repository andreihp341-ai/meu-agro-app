<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroTech AI - Especialista Total</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --agro-green: #27ae60; --dark: #1b262c; --white: #ffffff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: #f4f7f6; display: flex; flex-direction: column; height: 100vh; }
        header { background: var(--dark); color: white; padding: 15px; text-align: center; border-bottom: 4px solid var(--agro-green); }
        #weather-widget { background: #e8f5e9; padding: 10px; text-align: center; font-size: 0.85rem; color: var(--dark); border-bottom: 1px solid #ddd; font-weight: 500; }
        #chat { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .message { padding: 12px 18px; border-radius: 15px; max-width: 85%; font-size: 0.95rem; line-height: 1.5; }
        .bot-msg { background: white; align-self: flex-start; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-left: 4px solid var(--agro-green); }
        .user-msg { background: var(--agro-green); color: white; align-self: flex-end; }
        .input-area { background: white; padding: 15px; display: flex; gap: 10px; border-top: 1px solid #ddd; }
        input { flex: 1; padding: 12px; border: 2px solid #eee; border-radius: 25px; outline: none; }
        button { background: var(--agro-green); color: white; border: none; padding: 0 20px; border-radius: 25px; cursor: pointer; font-weight: bold; }
        #profile-selector { position: fixed; inset: 0; background: rgba(27,38,44,0.98); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .role-card { background: white; width: 90%; max-width: 350px; padding: 20px; margin: 10px; border-radius: 15px; cursor: pointer; }
    </style>
</head>
<body>

<header><h1>AgroTech AI üåø</h1></header>
<div id="weather-widget">üìç Monitorando clima de Ara√ßatuba...</div>

<div id="profile-selector">
    <h2 style="color:white; margin-bottom:20px;">Selecione seu Perfil</h2>
    <div class="role-card" onclick="selectRole('Produtor Rural')"><h3>üßë‚Äçüåæ Produtor</h3><p>Gest√£o e Safra.</p></div>
    <div class="role-card" onclick="selectRole('Engenheiro Agr√¥nomo')"><h3>üéì Agr√¥nomo</h3><p>T√©cnica e Precis√£o.</p></div>
</div>

<div id="chat"></div>

<div class="input-area">
    <input type="text" id="userInput" placeholder="Ex: Fale sobre agricultura de precis√£o...">
    <button onclick="handleAction()">Enviar</button>
</div>

<script>
    const WEATHER_KEY = "c971417bdb941190d1cde558e548e34d"; 
    let userRole = '';

    // BASE DE CONHECIMENTO AGRON√îMICO AMPLIADA
    const agroKnowledge = {
        "precisao": "A Agricultura de Precis√£o (AP) utiliza GPS, sensores e telemetria para gerenciar a variabilidade do solo. O objetivo √© aplicar o insumo correto, no local correto e na hora correta, aumentando a efici√™ncia e reduzindo custos.",
        "calcario": "A calagem √© essencial para corrigir a acidez do solo e fornecer C√°lcio e Magn√©sio. O c√°lculo base considera a Satura√ß√£o por Bases (V%). Lembre-se: aplique com anteced√™ncia m√≠nima de 60 a 90 dias antes do plantio para rea√ß√£o qu√≠mica ideal.",
        "manejo": "O Manejo Integrado de Pragas (MIP) foca no equil√≠brio. Utilize monitoramento constante, controle biol√≥gico e, em √∫ltima inst√¢ncia, defensivos qu√≠micos se atingir o n√≠vel de dano econ√¥mico.",
        "agronegocio": "O agroneg√≥cio brasileiro representa cerca de 25% do PIB nacional. Envolve desde a produ√ß√£o de insumos at√© a log√≠stica de exporta√ß√£o. Focar em ESG (sustentabilidade) √© a tend√™ncia global para manter mercados abertos.",
        "plantacao": "Para uma planta√ß√£o de sucesso, o Plantio Direto √© o 'padr√£o ouro': m√≠nima mobiliza√ß√£o do solo, cobertura permanente com palhada e rota√ß√£o de culturas para manter a sa√∫de biol√≥gica.",
        "soja": "A cultura da soja exige aten√ß√£o ao vazio sanit√°rio para evitar a ferrugem asi√°tica. A inocula√ß√£o com Bradyrhizobium √© vital para fixa√ß√£o de nitrog√™nio e economia de fertilizantes.",
        "milho": "No milho, a aduba√ß√£o de cobertura nitrogenada √© o fator cr√≠tico de produtividade. Monitore tamb√©m o percevejo barriga-verde e a cigarrinha-do-milho desde a emerg√™ncia.",
        "cana": "O setor sucroenerg√©tico exige planejamento de log√≠stica de colheita. O manejo da fertilidade foca em F√≥sforo no sulco de plantio e Pot√°ssio em cobertura.",
        "gps": "O uso de GPS e GNSS permite o autotrafego (piloto autom√°tico), reduzindo o pisoteio da cultura e a compacta√ß√£o do solo, al√©m de permitir o trabalho noturno com precis√£o milim√©trica.",
        "solo": "A sa√∫de do solo √© o seu maior ativo. Evite o excesso de mecaniza√ß√£o pesada em solos √∫midos para n√£o causar compacta√ß√£o, o que impede o crescimento radicular.",
        "drone": "Drones na agricultura servem para mapeamento de falhas, identifica√ß√£o de estresse h√≠drico e aplica√ß√£o localizada em √°reas de dif√≠cil acesso.",
        "calc√°rio": "O calc√°rio dolom√≠tico √© preferido quando o solo tamb√©m precisa de magn√©sio. J√° o calc√°rio calc√≠tico √© focado apenas no c√°lcio. Verifique sempre o PRNT (Poder Relativo de Neutraliza√ß√£o Total) do produto.",
        "fertilizante": "A regra dos 4Rs da fertiliza√ß√£o: Fonte Certa, Dose Certa, Hora Certa e Lugar Certo. Isso garante que a planta absorva o m√°ximo e o meio ambiente sofra o m√≠nimo."
    };

    async function getLiveWeather(city = "Ara√ßatuba") {
        const url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&lang=pt_br&appid=${WEATHER_KEY}`;
        try {
            const response = await fetch(url);
            const data = await response.json();
            document.getElementById('weather-widget').innerHTML = `üìç ${city}: ${Math.round(data.main.temp)}¬∞C | ${data.weather[0].description} | Umidade: ${data.main.humidity}%`;
        } catch (e) {
            document.getElementById('weather-widget').innerHTML = "üìç Ara√ßatuba: 28¬∞C | Ensolarado";
        }
    }

    function selectRole(role) {
        userRole = role;
        document.getElementById('profile-selector').style.display = 'none';
        addMessage(`Bem-vindo ao AgroTech AI. Atuando como ${role}. Digite palavras-chave como 'calc√°rio', 'precis√£o' ou 'manejo' para come√ßar.`, 'bot-msg');
        getLiveWeather();
    }

    function addMessage(text, type) {
        const msgDiv = document.createElement('div');
        msgDiv.className = `message ${type}`;
        msgDiv.innerText = text;
        document.getElementById('chat').appendChild(msgDiv);
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
    }

    function searchAgro(text) {
        const q = text.toLowerCase();
        let answers = [];

        // Busca m√∫ltipla: se o usu√°rio digitar "calcario e soja", traz os dois
        for (let key in agroKnowledge) {
            if (q.includes(key)) {
                answers.push(agroKnowledge[key]);
            }
        }

        if (answers.length > 0) {
            return answers.join("\n\n---\n\n");
        } else {
            return `Como seu consultor ${userRole}, entendo sua d√∫vida. No momento, minha base local cobre: Calc√°rio, Soja, Milho, Cana, GPS, Drones, Agricultura de Precis√£o e Manejo de Solo. Pode reformular sua pergunta usando uma dessas palavras?`;
        }
    }

    function handleAction() {
        const input = document.getElementById('userInput');
        const text = input.value.trim();
        if (!text) return;

        addMessage(text, 'user-msg');
        input.value = '';
        
        setTimeout(() => {
            const result = searchAgro(text);
            addMessage(result, 'bot-msg');
        }, 500);
    }
</script>
</body>
</html>
